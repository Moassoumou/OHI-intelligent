<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Coach Objectifs - Tableau de Bord Intelligent</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#3b82f6',
            secondary: '#8b5cf6',
            success: '#10b981',
            warning: '#f59e0b',
            danger: '#ef4444'
          }
        }
      }
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .card-hover { transition: all 0.3s ease; }
    .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1); }
    .progress-ring { transform: rotate(-90deg); }
    .chat-bubble { animation: slideIn 0.3s ease-out; }
    @keyframes slideIn { from { opacity: 0; transform: translateY(10px);} to { opacity: 1; transform: translateY(0);} }
    .pulse-dot { animation: pulse 2s infinite; }
    @keyframes pulse { 0%,100% { opacity: 1;} 50% { opacity: .5; } }
  </style>
</head>
<body class="bg-gray-50 min-h-screen">

  <!-- Header -->
  <header class="gradient-bg text-white shadow-lg">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between items-center py-6">
        <div class="flex items-center space-x-4">
          <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
            <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
              <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
          </div>
          <div>
            <h1 class="text-2xl font-bold">Coach Objectifs IA</h1>
            <p class="text-white text-opacity-80 text-sm">Votre compagnon intelligent pour atteindre vos objectifs</p>
          </div>
        </div>
        <div class="flex items-center space-x-4">
          <div class="flex items-center space-x-2 bg-white bg-opacity-20 rounded-lg px-4 py-2">
            <div class="w-2 h-2 bg-green-400 rounded-full pulse-dot"></div>
            <span class="text-sm">Coach actif</span>
          </div>
          <button id="toggleCoachBtn" class="w-10 h-10 bg-white bg-opacity-20 rounded-lg flex items-center justify-center hover:bg-opacity-30 transition-all">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M18 10c0 3.866-3.582 7-8 7a8.841 8.841 0 01-4.083-.98L2 17l1.338-3.123C2.493 12.767 2 11.434 2 10c0-3.866 3.582-7 8-7s8 3.134 8 7zM7 9H5v2h2V9zm8 0h-2v2h2V9zM9 9h2v2H9V9z" clip-rule="evenodd"/>
            </svg>
          </button>
        </div>
      </div>
    </div>
  </header>

  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">

    <!-- Coach IA Chat -->
    <div id="coachPanel" class="bg-white rounded-2xl p-6 shadow-sm mb-8 border-l-4 border-primary">
      <div class="flex items-start space-x-4">
        <div class="w-12 h-12 bg-primary bg-opacity-10 rounded-full flex items-center justify-center flex-shrink-0">
          <svg class="w-6 h-6 text-primary" fill="currentColor" viewBox="0 0 20 20">
            <path d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z"/>
          </svg>
        </div>
        <div class="flex-1">
          <div class="flex items-center space-x-2 mb-2">
            <h3 class="font-semibold text-gray-900">Coach IA</h3>
            <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded-full">En ligne</span>
          </div>
          <div id="coachMessage" class="text-gray-700 mb-4">
            Bonjour ! ğŸ‘‹ Je suis votre coach personnel. CommenÃ§ons par dÃ©finir votre premier objectif. Que souhaitez-vous accomplir ?
          </div>
          <div class="flex flex-wrap gap-2">
            <button data-quick="business" class="px-4 py-2 bg-blue-100 text-blue-800 rounded-lg text-sm hover:bg-blue-200 transition-colors">ğŸš€ Objectif Business</button>
            <button data-quick="personal" class="px-4 py-2 bg-green-100 text-green-800 rounded-lg text-sm hover:bg-green-200 transition-colors">ğŸ¯ Objectif Personnel</button>
            <button data-quick="learning" class="px-4 py-2 bg-purple-100 text-purple-800 rounded-lg text-sm hover:bg-purple-200 transition-colors">ğŸ“š Apprentissage</button>
            <button data-quick="health" class="px-4 py-2 bg-orange-100 text-orange-800 rounded-lg text-sm hover:bg-orange-200 transition-colors">ğŸ’ª SantÃ© & Bien-Ãªtre</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Objectifs + Progression -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
      <div class="lg:col-span-2">
        <div class="bg-white rounded-2xl p-6 shadow-sm">
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-xl font-semibold text-gray-900">Mes Objectifs</h3>
            <button id="addObjectiveBtn" class="bg-primary text-white px-4 py-2 rounded-lg text-sm hover:bg-blue-600 transition-colors">+ Nouvel Objectif</button>
          </div>
          <div id="objectivesList" class="space-y-4"></div>
        </div>
      </div>

      <div class="bg-white rounded-2xl p-6 shadow-sm">
        <h3 class="text-xl font-semibold text-gray-900 mb-6">Progression Globale</h3>
        <div class="flex items-center justify-center mb-6">
          <div class="relative w-32 h-32">
            <svg class="w-32 h-32 progress-ring">
              <circle cx="64" cy="64" r="56" stroke="#e5e7eb" stroke-width="8" fill="none"></circle>
              <circle id="progressCircle" cx="64" cy="64" r="56" stroke="#3b82f6" stroke-width="8" fill="none" stroke-dasharray="351.86" stroke-dashoffset="351.86" stroke-linecap="round"></circle>
            </svg>
            <div class="absolute inset-0 flex items-center justify-center">
              <span id="globalProgress" class="text-2xl font-bold text-gray-900">0%</span>
            </div>
          </div>
        </div>
        <div class="space-y-3">
          <div class="flex justify-between text-sm">
            <span class="text-gray-600">Objectifs complÃ©tÃ©s</span>
            <span id="completedCount" class="font-medium">0/0</span>
          </div>
          <div class="flex justify-between text-sm">
            <span class="text-gray-600">Streak actuel</span>
            <span id="currentStreak" class="font-medium text-green-600">0 jours</span>
          </div>
          <div class="flex justify-between text-sm">
            <span class="text-gray-600">Prochaine Ã©chÃ©ance</span>
            <span id="nextDeadline" class="font-medium text-orange-600">-</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Tourbillons -->
    <div class="bg-white rounded-2xl p-6 shadow-sm mb-8 border-l-4 border-orange-500">
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center space-x-3">
          <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center">
            <svg class="w-6 h-6 text-orange-600" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z" clip-rule="evenodd"/>
            </svg>
          </div>
          <div>
            <h3 class="text-xl font-semibold text-gray-900">ğŸŒªï¸ Tourbillons du Mois</h3>
            <p class="text-sm text-gray-600">Actions importantes pour ne pas se disperser</p>
          </div>
        </div>
        <div class="flex space-x-2">
          <button id="addWhirlwindBtn" class="bg-orange-600 text-white px-4 py-2 rounded-lg text-sm hover:bg-orange-700 transition-colors">+ Nouveau Tourbillon</button>
          <button id="managerModeBtn" class="bg-gray-200 text-gray-700 px-4 py-2 rounded-lg text-sm hover:bg-gray-300 transition-colors">ğŸ‘” Mode Responsable</button>
        </div>
      </div>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div>
          <h4 class="font-medium text-gray-900 mb-3">Actions en cours</h4>
          <div id="activeWhirlwinds" class="space-y-3"></div>
        </div>
        <div>
          <h4 class="font-medium text-gray-900 mb-3">Actions terminÃ©es</h4>
          <div id="completedWhirlwinds" class="space-y-3"></div>
        </div>
      </div>
    </div>

    <!-- Livrables + Actions recommandÃ©es -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
      <div class="bg-white rounded-2xl p-6 shadow-sm">
        <h3 class="text-xl font-semibold text-gray-900 mb-6">Livrables GÃ©nÃ©rÃ©s</h3>
        <div id="deliverablesList" class="space-y-3">
          <div class="text-center text-gray-500 py-8">
            <svg class="w-12 h-12 mx-auto mb-4 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 0v12h8V4H6z" clip-rule="evenodd"/>
            </svg>
            <p>Aucun livrable gÃ©nÃ©rÃ© pour le moment</p>
            <p class="text-sm">DÃ©finissez un objectif pour commencer</p>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-2xl p-6 shadow-sm">
        <div class="flex items-center justify-between mb-6">
          <h3 class="text-xl font-semibold text-gray-900">Actions RecommandÃ©es</h3>
          <button id="refreshRecoBtn" class="text-primary hover:text-blue-600 text-sm">ğŸ”„ Actualiser</button>
        </div>
        <div id="actionsList" class="space-y-3">
          <div class="text-center text-gray-500 py-8">
            <svg class="w-12 h-12 mx-auto mb-4 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
            </svg>
            <p>Aucune action recommandÃ©e</p>
            <p class="text-sm">Le coach analysera vos objectifs</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Stats -->
    <div class="bg-white rounded-2xl p-6 shadow-sm">
      <h3 class="text-xl font-semibold text-gray-900 mb-6">Insights & Statistiques</h3>
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        <div class="text-center">
          <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
            <svg class="w-8 h-8 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
              <path d="M2 10a8 8 0 018-8v8h8a8 8 0 11-16 0z"/>
              <path d="M12 2.252A8.014 8.014 0 0117.748 8H12V2.252z"/>
            </svg>
          </div>
          <p class="text-2xl font-bold text-gray-900" id="totalObjectives">0</p>
          <p class="text-sm text-gray-600">Objectifs crÃ©Ã©s</p>
        </div>
        <div class="text-center">
          <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
            <svg class="w-8 h-8 text-green-600" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
            </svg>
          </div>
          <p class="text-2xl font-bold text-gray-900" id="completedObjectives">0</p>
          <p class="text-sm text-gray-600">Objectifs atteints</p>
        </div>
        <div class="text-center">
          <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3">
            <svg class="w-8 h-8 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M12 7a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0V8.414l-4.293 4.293a1 1 0 01-1.414 0L8 10.414l-4.293 4.293a1 1 0 01-1.414-1.414l5-5a1 1 0 011.414 0L11 10.586 14.586 7H12z" clip-rule="evenodd"/>
            </svg>
          </div>
          <p class="text-2xl font-bold text-gray-900" id="averageProgress">0%</p>
          <p class="text-sm text-gray-600">Progression moyenne</p>
        </div>
        <div class="text-center">
          <div class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-3">
            <svg class="w-8 h-8 text-orange-600" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M6 2a1 1 0 00-1 1v1H4a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V6a2 2 0 00-2-2h-1V3a1 1 0 10-2 0v1H7V3a1 1 0 00-1-1zm0 5a1 1 0 000 2h8a1 1 0 100-2H6z" clip-rule="evenodd"/>
            </svg>
          </div>
          <p class="text-2xl font-bold text-gray-900" id="daysActive">0</p>
          <p class="text-sm text-gray-600">Jours actifs</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Objectif -->
  <div id="objectiveModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4">
      <h3 class="text-xl font-semibold text-gray-900 mb-6">CrÃ©er un Nouvel Objectif</h3>
      <form id="objectiveForm" class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Titre de l'objectif</label>
          <input type="text" id="objectiveTitle" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Ex: Lancer mon entreprise">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">CatÃ©gorie</label>
          <select id="objectiveCategory" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
            <option value="business">ğŸš€ Business</option>
            <option value="personal">ğŸ¯ Personnel</option>
            <option value="learning">ğŸ“š Apprentissage</option>
            <option value="health">ğŸ’ª SantÃ©</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Date limite</label>
          <input type="date" id="objectiveDeadline" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary focus:border-transparent">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Description (optionnel)</label>
          <textarea id="objectiveDescription" rows="3" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="DÃ©crivez votre objectif..."></textarea>
        </div>
        <div class="flex space-x-3 pt-4">
          <button type="button" id="cancelObjectiveBtn" class="flex-1 bg-gray-200 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-300 transition-colors">Annuler</button>
          <button type="submit" class="flex-1 bg-primary text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors">CrÃ©er</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal Tourbillon -->
  <div id="whirlwindModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-2xl p-8 max-w-lg w-full mx-4">
      <h3 class="text-xl font-semibold text-gray-900 mb-6">ğŸŒªï¸ Nouveau Tourbillon</h3>
      <form id="whirlwindForm" class="space-y-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Action Ã  mener</label>
          <input type="text" id="whirlwindTitle" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-500 focus:border-transparent" placeholder="Ex: Ã‰tablir la masse salariale">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">CatÃ©gorie</label>
          <select id="whirlwindCategory" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-500 focus:border-transparent">
            <option value="management">ğŸ‘¥ Management</option>
            <option value="finance">ğŸ’° Finance</option>
            <option value="operations">âš™ï¸ OpÃ©rations</option>
            <option value="strategy">ğŸ¯ StratÃ©gie</option>
            <option value="hr">ğŸ‘” RH</option>
            <option value="communication">ğŸ“¢ Communication</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">PrioritÃ©</label>
          <select id="whirlwindPriority" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-500 focus:border-transparent">
            <option value="high">ğŸ”´ Haute</option>
            <option value="medium">ğŸŸ¡ Moyenne</option>
            <option value="low">ğŸŸ¢ Basse</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Ã‰chÃ©ance</label>
          <input type="date" id="whirlwindDeadline" required class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-500 focus:border-transparent">
        </div>
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Notes</label>
          <textarea id="whirlwindNotes" rows="3" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-orange-500 focus:border-transparent" placeholder="DÃ©tails, personnes impliquÃ©es, ressources nÃ©cessaires..."></textarea>
        </div>
        <div class="flex space-x-3 pt-4">
          <button type="button" id="cancelWhirlwindBtn" class="flex-1 bg-gray-200 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-300 transition-colors">Annuler</button>
          <button type="submit" class="flex-1 bg-orange-600 text-white py-2 px-4 rounded-lg hover:bg-orange-700 transition-colors">CrÃ©er</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Firebase (optionnel) -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
  <script src="./firebase.js"></script>

  <!-- App -->
  <script>
  (function () {
    'use strict';

    // --- STATE ---
    let objectives = [];
    let whirlwinds = [];
    let coachVisible = true;
    let managerMode = false;

    const $ = (id) => document.getElementById(id);

    // --- COACH ---
    const coachMessages = {
      welcome: "Bonjour ! ğŸ‘‹ Je suis votre coach personnel. CommenÃ§ons par dÃ©finir votre premier objectif. Que souhaitez-vous accomplir ?",
      firstObjective: "Excellent choix ! ğŸ¯ Je vais gÃ©nÃ©rer un plan d'action personnalisÃ© pour vous aider Ã  atteindre cet objectif. Voici mes recommandations :",
      progress: "Bravo pour vos progrÃ¨s ! ğŸŒŸ Continuez sur cette lancÃ©e. Voici ce que je recommande pour la suite :",
      motivation: "Je remarque que vous n'avez pas mis Ã  jour vos objectifs rÃ©cemment. ğŸ’ª Prenons quelques minutes pour faire le point ensemble !",
      celebration: "FÃ©licitations ! ğŸ‰ Vous avez atteint un objectif important. ÃŠtes-vous prÃªt pour le prochain dÃ©fi ?"
    };

    function updateCoachMessage(type, customMessage = null) {
      const messageElement = $('coachMessage');
      const message = customMessage || coachMessages[type];
      messageElement.innerHTML = message;
      messageElement.classList.add('chat-bubble');
      setTimeout(()=>messageElement.classList.remove('chat-bubble'), 350);
    }

    // --- UI HELPERS ---
    function openModal(id) {
      const m = $(id);
      m.classList.remove('hidden'); m.classList.add('flex');
    }
    function closeModal(id) {
      const m = $(id);
      m.classList.add('hidden'); m.classList.remove('flex');
    }

    // --- GENERATORS (deliverables & actions) ---
    function generateDeliverables(objective) {
      const byCat = {
        business: ["Plan d'affaires dÃ©taillÃ©","StratÃ©gie marketing","Analyse de la concurrence","PrÃ©visions financiÃ¨res"],
        personal: ["Planning hebdomadaire optimisÃ©","Liste de prioritÃ©s personnelles","Routine de bien-Ãªtre","Objectifs de dÃ©veloppement personnel"],
        learning: ["Programme d'apprentissage structurÃ©","Ressources et supports de cours","Planning de rÃ©visions","Projets pratiques"],
        health: ["Programme d'entraÃ®nement personnalisÃ©","Plan nutritionnel Ã©quilibrÃ©","Suivi des progrÃ¨s","Objectifs hebdomadaires"]
      };
      return byCat[objective.category] || ["Plan d'action personnalisÃ©"];
    }

    function generateActions(objective) {
      const bank = {
        business: [
          { action:"CrÃ©er un plan d'affaires simple", description:"DÃ©finissez votre idÃ©e, votre marchÃ© et vos revenus",
            steps:["DÃ©crire votre idÃ©e en une phrase","Identifier 3 clients potentiels","Calculer vos coÃ»ts de base","DÃ©finir votre prix de vente"],
            progress:0, advancedResources:["ğŸ“– Business Model Canvas - Alexander Osterwalder","ğŸ“š The Lean Startup - Eric Ries","ğŸ“ Coursera Entrepreneurship","ğŸŒ SCORE.org"] },
          { action:"Analyser la concurrence", description:"Ã‰tudiez 5 concurrents directs pour vous positionner",
            steps:["Lister 5 concurrents","Analyser leurs prix/services","Identifier leurs points faibles","DÃ©finir votre avantage unique"],
            progress:0, advancedResources:["ğŸ“– Blue Ocean Strategy","ğŸ” SEMrush","ğŸ“Š SimilarWeb","ğŸ¯ Porterâ€™s 5 Forces"] },
          { action:"DÃ©finir votre clientÃ¨le cible", description:"CrÃ©ez le profil de votre client idÃ©al",
            steps:["Ã‚ge/genre","Besoins principaux","OÃ¹ les trouver","Budget typique"],
            progress:0, advancedResources:["ğŸ“– The Mom Test","ğŸ¯ Personas HubSpot","ğŸ“Š GA Audience","ğŸ”¬ Jobs-to-be-Done"] }
        ],
        personal: [
          { action:"Organiser votre temps quotidien", description:"CrÃ©ez une routine qui fonctionne pour vous",
            steps:["Lister vos activitÃ©s","3 prioritÃ©s/jour","Time blocking","Supprimer 2 non-essentielles"],
            progress:0, advancedResources:["ğŸ“– GTD - David Allen","â° Pomodoro","ğŸ“± Todoist/Notion","ğŸ“ Time Management"] },
          { action:"Ã‰quilibre vie-travail", description:"Fixez des limites claires",
            steps:["Horaires fixes","Espace dÃ©diÃ©","Temps loisirs","Dire non"],
            progress:0, advancedResources:["ğŸ“– 4-Hour Workweek","ğŸ§˜ Mindfulness @ Work","ğŸ“± Headspace/Calm","ğŸ¯ Boundaries"] },
          { action:"Nouvelle habitude positive", description:"IntÃ©grez une habitude bÃ©nÃ©fique",
            steps:["Choix dâ€™une habitude","Empilement dâ€™habitudes","2 minutes/jour","Suivi visuel"],
            progress:0, advancedResources:["ğŸ“– Atomic Habits","ğŸ§  Power of Habit","ğŸ“± Habitica/Streaks","ğŸ“ Behavior Change"] }
        ],
        learning: [
          { action:"Apprendre une compÃ©tence", description:"MaÃ®triser les bases en 30 jours",
            steps:["Choisir la compÃ©tence","3 ressources","30 min/jour","Projet concret"],
            progress:0, advancedResources:["ğŸ“– Peak","ğŸ“ Coursera/Udemy","ğŸ§  Feynman","ğŸ“š Anki"] },
          { action:"Lire efficacement", description:"Augmenter vitesse & comprÃ©hension",
            steps:["Mesurer vitesse","Limiter subvocalisation","Guide visuel","15 min/jour"],
            progress:0, advancedResources:["ğŸ“– How to Read a Book","âš¡ Speed Reading","ğŸ“± Spreeder","ğŸ¯ SQ3R"] },
          { action:"Mieux mÃ©moriser", description:"Techniques de rÃ©tention durable",
            steps:["Assoc. visuelles","RÃ©pÃ©tition espacÃ©e","Enseigner","Auto-tests"],
            progress:0, advancedResources:["ğŸ“– Moonwalking with Einstein","ğŸ§  Memory Palace","ğŸ“± Anki/Quizlet","ğŸ“ Learning How to Learn"] }
        ],
        health: [
          { action:"Bouger plus", description:"Plus dâ€™activitÃ© au quotidien",
            steps:["Marche post-repas","Escaliers","Ã‰tirements/heure","3 sÃ©ances/semaine"],
            progress:0, advancedResources:["ğŸ“– Spark","ğŸ’ª 7-Min Workout","ğŸƒ C25K","ğŸ¯ HIIT"] },
          { action:"Mieux manger", description:"Habitudes alimentaires saines",
            steps:["Eau avant repas","LÃ©gumes Ã  chaque repas","-20% portions","Batch cooking"],
            progress:0, advancedResources:["ğŸ“– How Not to Die","ğŸ¥— MÃ©diterranÃ©enne","ğŸ“± MyFitnessPal","ğŸ“ Nutrition edX"] },
          { action:"Sommeil", description:"Optimiser Ã©nergie",
            steps:["Coucher rÃ©gulier","Sans Ã©crans -1h","Chambre fraÃ®che/sombre","Routine relaxation"],
            progress:0, advancedResources:["ğŸ“– Why We Sleep","ğŸ˜´ Sleep hygiene","ğŸ“± Sleep Cycle","ğŸŒ™ Circadian Rhythm"] }
        ]
      };
      return bank[objective.category] || [{
        action:"DÃ©finir un plan d'action", description:"CrÃ©ez un plan simple pour atteindre votre objectif",
        steps:["Objectif prÃ©cis","Ã‰tapes nÃ©cessaires","Ã‰chÃ©ances rÃ©alistes","Commencer par la 1Ã¨re Ã©tape"],
        progress:0, advancedResources:["ğŸ“– SMART","ğŸ¯ OKR","ğŸ“Š PM Basics","ğŸ”„ Agile"]
      }];
    }

    // --- RENDERERS ---
    function renderObjectives() {
      const container = $('objectivesList');
      if (!objectives.length) {
        container.innerHTML = `
          <div class="text-center text-gray-500 py-8">
            <svg class="w-12 h-12 mx-auto mb-4 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
              <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <p>Aucun objectif dÃ©fini</p>
            <p class="text-sm">CrÃ©ez votre premier objectif pour commencer</p>
          </div>`;
        return;
      }

      const categoryIcons = { business:'ğŸš€', personal:'ğŸ¯', learning:'ğŸ“š', health:'ğŸ’ª' };
      container.innerHTML = objectives.map(obj => {
        const daysLeft = Math.ceil((new Date(obj.deadline) - new Date()) / 86400000);
        const isOverdue = daysLeft < 0;
        return `
          <div class="border border-gray-200 rounded-xl p-4 card-hover">
            <div class="flex items-start justify-between mb-3">
              <div class="flex items-start space-x-3">
                <span class="text-2xl">${categoryIcons[obj.category] || 'ğŸ¯'}</span>
                <div>
                  <h4 class="font-semibold text-gray-900">${obj.title}</h4>
                  <p class="text-sm text-gray-600">${obj.description || ''}</p>
                </div>
              </div>
              <div class="text-right">
                <span class="text-sm ${isOverdue ? 'text-red-600' : 'text-gray-600'}">
                  ${isOverdue ? `${Math.abs(daysLeft)} jours de retard` : `${daysLeft} jours restants`}
                </span>
              </div>
            </div>
            <div class="mb-3">
              <div class="flex justify-between text-sm mb-1">
                <span class="text-gray-600">Progression</span>
                <span class="font-medium">${obj.progress}%</span>
              </div>
              <div class="w-full bg-gray-200 rounded-full h-2">
                <div class="bg-primary h-2 rounded-full transition-all duration-300" style="width:${obj.progress}%"></div>
              </div>
            </div>
            <div class="flex space-x-2">
              <button data-dec="${obj.id}" class="px-3 py-1 bg-gray-100 hover:bg-gray-200 rounded text-sm transition-colors">-10%</button>
              <button data-inc="${obj.id}" class="px-3 py-1 bg-primary text-white hover:bg-blue-600 rounded text-sm transition-colors">+10%</button>
              <button data-done="${obj.id}" class="px-3 py-1 bg-green-600 text-white hover:bg-green-700 rounded text-sm transition-colors">TerminÃ©</button>
              <button data-del="${obj.id}" class="px-3 py-1 bg-red-100 text-red-600 hover:bg-red-200 rounded text-sm transition-colors">Supprimer</button>
            </div>
          </div>`;
      }).join('');
    }

    function renderDeliverables() {
      const container = $('deliverablesList');
      if (!objectives.length) {
        container.innerHTML = `
          <div class="text-center text-gray-500 py-8">
            <svg class="w-12 h-12 mx-auto mb-4 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 0v12h8V4H6z" clip-rule="evenodd"/>
            </svg>
            <p>Aucun livrable gÃ©nÃ©rÃ©</p>
            <p class="text-sm">CrÃ©ez un objectif pour voir les livrables</p>
          </div>`;
        return;
      }

      container.innerHTML = objectives.map(obj => `
        <div class="mb-4">
          <h4 class="font-medium text-gray-900 mb-2">${obj.title}</h4>
          <div class="space-y-2">
            ${obj.deliverables.map(d => `
              <div class="flex items-center space-x-3 p-2 bg-gray-50 rounded-lg">
                <svg class="w-4 h-4 text-primary" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 0v12h8V4H6z" clip-rule="evenodd"/>
                </svg>
                <span class="text-sm text-gray-700">${d}</span>
              </div>`).join('')}
          </div>
        </div>
      `).join('');
    }

    function renderActions() {
      const container = $('actionsList');
      if (!objectives.length) {
        container.innerHTML = `
          <div class="text-center text-gray-500 py-8">
            <svg class="w-12 h-12 mx-auto mb-4 text-gray-300" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"/>
            </svg>
            <p>Aucune action recommandÃ©e</p>
            <p class="text-sm">Le coach analysera vos objectifs</p>
          </div>`;
        return;
      }

      const latest = objectives[objectives.length - 1];
      container.innerHTML = `
        <div class="space-y-4">
          ${latest.actions.map((a, i) => `
            <div class="border border-gray-200 rounded-lg p-4 bg-gradient-to-r from-blue-50 to-indigo-50">
              <div class="flex items-start space-x-3">
                <div class="w-8 h-8 bg-primary text-white rounded-full flex items-center justify-center text-sm font-bold flex-shrink-0">${i+1}</div>
                <div class="flex-1">
                  <h4 class="font-semibold text-gray-900 mb-1">${a.action}</h4>
                  <p class="text-sm text-gray-600 mb-3">${a.description}</p>

                  <div class="mb-3">
                    <div class="flex justify-between text-xs mb-1">
                      <span class="text-gray-600">Progression</span>
                      <span class="font-medium">${a.progress}%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2">
                      <div class="bg-green-500 h-2 rounded-full transition-all duration-300" style="width:${a.progress}%"></div>
                    </div>
                  </div>

                  <div class="mb-3">
                    <h5 class="text-xs font-medium text-gray-900 mb-2">Ã‰tapes Ã  suivre :</h5>
                    <div class="space-y-1">
                      ${a.steps.map((s, si) => `
                        <label class="flex items-start space-x-2 text-xs text-gray-700 cursor-pointer">
                          <input type="checkbox" data-step="${i}:${si}" class="mt-1 w-3 h-3 text-green-600 rounded">
                          <span>${s}</span>
                        </label>
                      `).join('')}
                    </div>
                  </div>

                  <div class="mb-3">
                    <button data-adv="${i}" class="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded-full hover:bg-purple-200 transition-colors">ğŸ“š Ressources pour aller plus loin</button>
                    <div id="adv-${i}" class="hidden mt-2 bg-white rounded-lg p-3 border border-purple-200">
                      <h5 class="font-medium text-gray-900 mb-2 text-xs">Pour approfondir :</h5>
                      <div class="space-y-1 text-xs text-gray-700">
                        ${a.advancedResources.map(r=>`<div class="flex items-start space-x-2"><span class="text-purple-600">â€¢</span><span>${r}</span></div>`).join('')}
                      </div>
                    </div>
                  </div>

                  <div class="flex items-center justify-between">
                    <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded-full">Action recommandÃ©e</span>
                    <button data-done-action="${i}" class="text-xs text-primary hover:text-blue-600 font-medium">âœ“ Action terminÃ©e</button>
                  </div>
                </div>
              </div>
            </div>
          `).join('')}
        </div>`;
    }

    function renderWhirlwinds() {
      const active = $('activeWhirlwinds');
      const done = $('completedWhirlwinds');
      const actives = whirlwinds.filter(w=>!w.completed);
      const dones = whirlwinds.filter(w=>w.completed);

      if (!actives.length) {
        active.innerHTML = `<div class="text-center text-gray-500 py-4"><p class="text-sm">Aucune action en cours</p></div>`;
      } else {
        const icons = { management:'ğŸ‘¥', finance:'ğŸ’°', operations:'âš™ï¸', strategy:'ğŸ¯', hr:'ğŸ‘”', communication:'ğŸ“¢' };
        const colors = { high:'border-red-500 bg-red-50', medium:'border-yellow-500 bg-yellow-50', low:'border-green-500 bg-green-50' };
        const labels = { high:'ğŸ”´ Haute', medium:'ğŸŸ¡ Moyenne', low:'ğŸŸ¢ Basse' };

        active.innerHTML = actives.map(w=>{
          const daysLeft = Math.ceil((new Date(w.deadline) - new Date())/86400000);
          const isOverdue = daysLeft < 0;
          return `
            <div class="border-l-4 ${colors[w.priority]} p-4 rounded-lg">
              <div class="flex items-start justify-between mb-2">
                <div class="flex items-center space-x-2">
                  <span class="text-lg">${icons[w.category]||'ğŸ“Œ'}</span>
                  <h4 class="font-medium text-gray-900">${w.title}</h4>
                  ${w.createdBy === 'manager' ? '<span class="text-xs bg-orange-100 text-orange-800 px-2 py-1 rounded-full">ğŸ‘” Responsable</span>' : ''}
                </div>
                <span class="text-xs ${isOverdue?'text-red-600':'text-gray-600'}">${isOverdue?`${Math.abs(daysLeft)}j retard`:`${daysLeft}j restants`}</span>
              </div>
              <p class="text-sm text-gray-600 mb-3">${w.notes||''}</p>
              <div class="flex items-center justify-between">
                <span class="text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-700">${labels[w.priority]}</span>
                <div class="space-x-2">
                  <button data-wdone="${w.id}" class="text-xs bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700 transition-colors">âœ“ TerminÃ©</button>
                  <button data-wdel="${w.id}" class="text-xs bg-red-100 text-red-600 px-3 py-1 rounded hover:bg-red-200 transition-colors">Supprimer</button>
                </div>
              </div>
            </div>`;
        }).join('');
      }

      if (!dones.length) {
        done.innerHTML = `<div class="text-center text-gray-500 py-4"><p class="text-sm">Aucune action terminÃ©e</p></div>`;
      } else {
        const icons = { management:'ğŸ‘¥', finance:'ğŸ’°', operations:'âš™ï¸', strategy:'ğŸ¯', hr:'ğŸ‘”', communication:'ğŸ“¢' };
        done.innerHTML = dones.slice(-3).map(w=>`
          <div class="border border-gray-200 p-3 rounded-lg bg-gray-50 opacity-75">
            <div class="flex items-center space-x-2 mb-1">
              <span class="text-sm">${icons[w.category]||'ğŸ“Œ'}</span>
              <h4 class="text-sm font-medium text-gray-700 line-through">${w.title}</h4>
              <span class="text-xs text-green-600">âœ“</span>
            </div>
            <p class="text-xs text-gray-500">${w.notes||''}</p>
          </div>
        `).join('');
      }
    }

    function updateStats() {
      const total = objectives.length;
      const completed = objectives.filter(o=>o.completed).length;
      const avg = total ? Math.round(objectives.reduce((s,o)=>s+o.progress,0)/total) : 0;

      $('totalObjectives').textContent = total;
      $('completedObjectives').textContent = completed;
      $('completedCount').textContent = `${completed}/${total}`;
      $('averageProgress').textContent = `${avg}%`;
      $('globalProgress').textContent = `${avg}%`;

      const circle = $('progressCircle');
      const circumference = 2 * Math.PI * 56;
      circle.style.strokeDashoffset = (circumference - (avg/100)*circumference);

      $('daysActive').textContent = Math.max(1, total * 7);
      $('currentStreak').textContent = `${Math.min(total * 3, 30)} jours`;

      const next = objectives.filter(o=>!o.completed).sort((a,b)=>new Date(a.deadline)-new Date(b.deadline))[0];
      $('nextDeadline').textContent = next ? `${Math.ceil((new Date(next.deadline)-new Date())/86400000)} jours` : '-';
    }

    // --- LOCAL ACTIONS ---
    function updateProgress(id, delta) {
      const obj = objectives.find(o=>o.id===id);
      if (!obj) return;
      obj.progress = Math.max(0, Math.min(100, obj.progress + delta));
      if (obj.progress === 100) { obj.completed = true; updateCoachMessage('celebration'); }
      renderObjectives(); updateStats();
    }
    function completeObjective(id) {
      const obj = objectives.find(o=>o.id===id);
      if (!obj) return;
      obj.progress = 100; obj.completed = true;
      renderObjectives(); updateStats(); updateCoachMessage('celebration');
    }
    function deleteObjective(id) {
      objectives = objectives.filter(o=>o.id!==id);
      renderObjectives(); renderDeliverables(); renderActions(); updateStats();
    }
    function completeWhirlwind(id) {
      const w = whirlwinds.find(x=>x.id===id);
      if (!w) return;
      w.completed = true; w.completedAt = new Date();
      renderWhirlwinds();
      updateCoachMessage('celebration','ğŸ‰ Excellent ! Une action de moins dans le tourbillon. Vous gardez le cap !');
    }
    function deleteWhirlwind(id) {
      whirlwinds = whirlwinds.filter(x=>x.id!==id);
      renderWhirlwinds();
    }

    // --- FIREBASE (optionnel & silencieux) ---
    const hasFirebase = typeof firebase !== 'undefined' && firebase.apps && firebase.apps.length > 0;
    const db = hasFirebase ? firebase.firestore() : null;
    const auth = hasFirebase ? firebase.auth() : null;

    async function saveObjectiveToFirestore(obj) {
      try {
        if (!db) return;
        const uid = auth && auth.currentUser ? auth.currentUser.uid : null;
        await db.collection('ohis').add({ ...obj, uid: uid || null });
      } catch(e){ console.warn('Firestore (ohis) non enregistrÃ©:', e); }
    }
    async function saveWhirlwindToFirestore(w) {
      try {
        if (!db) return;
        const uid = auth && auth.currentUser ? auth.currentUser.uid : null;
        await db.collection('whirlwinds').add({ ...w, uid: uid || null });
      } catch(e){ console.warn('Firestore (whirlwinds) non enregistrÃ©:', e); }
    }

    // --- EVENTS BINDING ---
    // Ouverture/fermeture modals
    $('addObjectiveBtn').addEventListener('click', () => {
      // date par dÃ©faut +3 mois
      const d = new Date(); d.setMonth(d.getMonth()+3);
      $('objectiveDeadline').value = d.toISOString().split('T')[0];
      openModal('objectiveModal');
    });
    $('cancelObjectiveBtn').addEventListener('click', ()=> closeModal('objectiveModal'));

    $('addWhirlwindBtn').addEventListener('click', () => {
      const d = new Date(); d.setMonth(d.getMonth()+1);
      $('whirlwindDeadline').value = d.toISOString().split('T')[0];
      openModal('whirlwindModal');
    });
    $('cancelWhirlwindBtn').addEventListener('click', ()=> closeModal('whirlwindModal'));

    // Bouton affichage Coach
    $('toggleCoachBtn').addEventListener('click', ()=>{
      coachVisible = !coachVisible;
      $('coachPanel').style.display = coachVisible ? 'block' : 'none';
    });

    // Quick objective buttons
    document.querySelectorAll('[data-quick]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const type = btn.getAttribute('data-quick');
        const presets = {
          business:{title:"DÃ©velopper mon activitÃ©", category:"business", description:"Augmenter mon chiffre d'affaires et dÃ©velopper ma clientÃ¨le"},
          personal:{title:"Ã‰quilibre vie-travail", category:"personal", description:"Plus de temps pour famille & loisirs"},
          learning:{title:"Apprendre une nouvelle compÃ©tence", category:"learning", description:"MaÃ®triser une nouvelle techno ou langue"},
          health:{title:"AmÃ©liorer ma condition physique", category:"health", description:"Routine d'exercice rÃ©guliÃ¨re"}
        };
        const t = presets[type];
        $('objectiveTitle').value = t.title;
        $('objectiveCategory').value = t.category;
        $('objectiveDescription').value = t.description;
        const d = new Date(); d.setMonth(d.getMonth()+3);
        $('objectiveDeadline').value = d.toISOString().split('T')[0];
        openModal('objectiveModal');
      });
    });

    // Submit Objectif
    $('objectiveForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const newObj = {
        id: Date.now(),
        title: $('objectiveTitle').value.trim(),
        category: $('objectiveCategory').value,
        deadline: $('objectiveDeadline').value,
        description: $('objectiveDescription').value.trim(),
        progress: 0,
        completed: false,
        createdAt: new Date(),
        deliverables: [],
        actions: []
      };
      newObj.deliverables = generateDeliverables(newObj);
      newObj.actions = generateActions(newObj);

      objectives.push(newObj);
      renderObjectives(); renderDeliverables(); renderActions(); updateStats();
      closeModal('objectiveModal');

      // Firestore optionnel
      saveObjectiveToFirestore(newObj);

      updateCoachMessage(objectives.length === 1 ? 'firstObjective' : 'progress');
    });

    // Submit Tourbillon
    $('whirlwindForm').addEventListener('submit', async (e)=>{
      e.preventDefault();
      const newW = {
        id: Date.now(),
        title: $('whirlwindTitle').value.trim(),
        category: $('whirlwindCategory').value,
        priority: $('whirlwindPriority').value,
        deadline: $('whirlwindDeadline').value,
        notes: $('whirlwindNotes').value.trim(),
        completed: false,
        createdAt: new Date(),
        createdBy: managerMode ? 'manager' : 'user'
      };
      whirlwinds.push(newW);
      renderWhirlwinds();
      closeModal('whirlwindModal');

      // Firestore optionnel
      saveWhirlwindToFirestore(newW);

      updateCoachMessage(managerMode
        ? 'motivation'
        : 'motivation');
    });

    // Actions list interactions (delegation)
    document.addEventListener('click', (e)=>{
      const t = e.target;

      // Objectives buttons
      if (t.hasAttribute('data-inc')) updateProgress(+t.getAttribute('data-inc'), +10);
      if (t.hasAttribute('data-dec')) updateProgress(+t.getAttribute('data-dec'), -10);
      if (t.hasAttribute('data-done')) completeObjective(+t.getAttribute('data-done'));
      if (t.hasAttribute('data-del')) deleteObjective(+t.getAttribute('data-del'));

      // Whirlwinds buttons
      if (t.hasAttribute('data-wdone')) completeWhirlwind(+t.getAttribute('data-wdone'));
      if (t.hasAttribute('data-wdel')) deleteWhirlwind(+t.getAttribute('data-wdel'));

      // Advanced resources toggle
      if (t.hasAttribute('data-adv')) {
        const idx = t.getAttribute('data-adv');
        const panel = $('adv-'+idx);
        panel.classList.toggle('hidden');
      }

      // Mark action done
      if (t.hasAttribute('data-done-action')) {
        const idx = +t.getAttribute('data-done-action');
        const latest = objectives[objectives.length - 1];
        if (!latest) return;
        latest.actions[idx].progress = 100;
        renderActions();
        updateCoachMessage('celebration','ğŸ‰ Excellent travail ! Vous avez terminÃ© cette action. Continuez sur cette lancÃ©e !');
      }
    });

    // Steps checkboxes (progress auto)
    document.addEventListener('change', (e)=>{
      const t = e.target;
      if (t.hasAttribute('data-step')) {
        const [ai, si] = t.getAttribute('data-step').split(':').map(Number);
        const latest = objectives[objectives.length - 1];
        if (!latest) return;
        const a = latest.actions[ai];
        const total = a.steps.length;
        const checked = document.querySelectorAll(`input[type="checkbox"][data-step^="${ai}:"]:checked`).length;
        a.progress = Math.round((checked/total)*100);
        renderActions();
      }
    });

    // Manager mode
    $('managerModeBtn').addEventListener('click', ()=>{
      managerMode = !managerMode;
      const btn = $('managerModeBtn');
      if (managerMode) {
        btn.textContent = 'ğŸ‘¤ Mode Utilisateur';
        btn.classList.remove('bg-gray-200','text-gray-700');
        btn.classList.add('bg-orange-600','text-white');
        updateCoachMessage('motivation','ğŸ‘” Mode Responsable activÃ© ! Vous pouvez maintenant suggÃ©rer des actions futures Ã  votre Ã©quipe.');
      } else {
        btn.textContent = 'ğŸ‘” Mode Responsable';
        btn.classList.remove('bg-orange-600','text-white');
        btn.classList.add('bg-gray-200','text-gray-700');
        updateCoachMessage('motivation','ğŸ‘¤ Retour au mode utilisateur. Concentrez-vous sur vos objectifs personnels.');
      }
    });

    // Recommandations
    $('refreshRecoBtn').addEventListener('click', ()=>{
      if (managerMode && whirlwinds.length < 5) {
        const suggestions = [
          { title:"RÃ©vision des processus qualitÃ©", category:"operations", priority:"high", notes:"Audit des procÃ©dures et pistes dâ€™amÃ©lioration" },
          { title:"Formation Ã©quipe nouvelles technologies", category:"hr", priority:"medium", notes:"Planifier des sessions de mise Ã  niveau" },
          { title:"Analyse des coÃ»ts opÃ©rationnels", category:"finance", priority:"high", notes:"Identifier les postes de dÃ©penses optimisables" },
          { title:"RÃ©union stratÃ©gique trimestrielle", category:"strategy", priority:"medium", notes:"Aligner objectifs et ajuster la stratÃ©gie" }
        ];
        const s = suggestions[Math.floor(Math.random()*suggestions.length)];
        const d = new Date(); d.setMonth(d.getMonth()+1);
        const w = { id:Date.now(), ...s, deadline:d.toISOString().split('T')[0], completed:false, createdAt:new Date(), createdBy:'manager' };
        whirlwinds.push(w);
        renderWhirlwinds();
        saveWhirlwindToFirestore(w);
        updateCoachMessage('motivation',"ğŸ’¡ Suggestion ajoutÃ©e d'aprÃ¨s les meilleures pratiques !");
      } else {
        updateCoachMessage('motivation',"ğŸ”„ Recommandations actualisÃ©es ! Concentrez-vous d'abord sur vos actions en cours.");
      }
    });

    // Periodic coach tips (demo)
    setInterval(()=>{
      if (objectives.length && Math.random() > 0.7) {
        const tips = [
          "ğŸ’¡ Astuce : Divisez vos grands objectifs en petites Ã©tapes quotidiennes !",
          "ğŸŒŸ Vous progressez bien ! N'oubliez pas de cÃ©lÃ©brer vos petites victoires.",
          "â° Il est temps de faire le point sur vos objectifs. Comment vous sentez-vous ?",
          "ğŸš€ PrÃªt pour un nouveau dÃ©fi ? Vos progrÃ¨s sont impressionnants !",
          "ğŸ’ª La constance est la clÃ© du succÃ¨s. Continuez sur cette lancÃ©e !"
        ];
        updateCoachMessage('motivation', tips[Math.floor(Math.random()*tips.length)]);
      }
    }, 30000);

    // Initial render
    renderObjectives(); renderDeliverables(); renderActions(); renderWhirlwinds(); updateStats();
    updateCoachMessage('welcome');
  })();
  </script>
</body>
</html>
